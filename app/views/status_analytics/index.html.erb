<h2><%= l(:label_status_analytics) %>: <%= @project.name %></h2>

<div class="splitcontent">
  <div class="splitcontentleft" style="width: 45%;">
    <div class="box">
      <h3>Durum Bazlı Zaman Analizi</h3>
      <table class="list">
        <thead>
          <tr>
            <th>Durum Adı</th>
            <th>Toplam Süre (Gün)</th>
          </tr>
        </thead>
        <tbody>
          <% if @durum_sureleri.any? %>
            <% @durum_sureleri.each do |isim, saniye| %>
              <tr>
                <td class="name"><strong><%= isim %></strong></td>
                <td class="hours"><%= (saniye / 86400).round(2) %> gün</td>
              </tr>
            <% end %>
          <% else %>
            <tr><td colspan="2">Hesaplanmış veri bulunamadı.</td></tr>
          <% end %>
        </tbody>
      </table>
      <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
        * Süreler, iş kayıtlarının tarihçesi (journals) üzerinden hesaplanmıştır.
      </p>
    </div>
  </div>

  <div class="splitcontentright" style="width: 50%;">
    <div class="box">
      <canvas id="lifecycleChart" width="400" height="400"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const ctx = document.getElementById('lifecycleChart').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: <%= raw @etiketler.to_json %>,
        datasets: [{
          data: <%= raw @veriler.to_json %>,
          backgroundColor: [
            '#FFCDD2', '#F8BBD0', '#E1BEE7', '#D1C4E9', 
            '#C5CAE9', '#BBDEFB', '#B3E5FC', '#B2EBF2'
          ],
          borderColor: '#ffffff',
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          title: { display: true, text: 'Zaman Dağılımı (Gün Bazında)' }
        }
      }
    });
  });
</script>
